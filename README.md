# Trains

This project processes train journey data and converts GPX files to GeoJSON format. It combines train journey data with GeoJSON features to create a feature collection of journeys.

## Project Structure

The project is structured as follows:

```
data/
    gpx/
        leeds_manchester.gpx
        cardiff_bristol.gpx
        ...
    geojson/
        leeds_manchester.geojson
        cardiff_bristol.geojson
        ...
    journey.json
    trainline.csv
output/
    total_journey.geojson
    train_journey.geojson
main.py
poetry.lock
pyproject.toml
README.md
```

You can save `gpx` files into the `data/gpx/` directory and run the following GDAL command to convert them to GeoJSON format.

```bash
for file in data/gpx/*.gpx; do ogr2ogr -f "GeoJSON" -nlt LINESTRING -sql "SELECT *, 'yes' AS bike FROM tracks" "data/geojson/$(basename "${file%.gpx}.geojson")" "$file"; done
```

The `journey.json` file contains the journey data, with a object for each train leg and relevant information.

The `trainline.csv` file comes from [Trainline.eu](https://www.thetrainline.com/) and is used to map train stations to their respective ids. This can be downloaded with the command:

```bash
curl https://raw.githubusercontent.com/trainline-eu/stations/master/stations.csv > data/trainline.csv
```

The `output/` directory contains the final GeoJSON files that are generated by the script.

## Running the Script

First set up the Python environment with Poetry:

```bash
poetry install
```

Then run the script:

```bash
poetry run python main.py
```

This will generate the `output/train_journey.geojson`. You can copy this using the command:

```bash
cp output/train_journey.geojson output/total_journey.geojson
```

Then open the `output/total_journey.geojson` file in a editor and add any additional GeoJSON features you want to include in the feature collection.

## Shoutouts

This project relies on [https://trainmap.ntag.fr/](https://trainmap.ntag.fr/) to fetch the geometric data for the train journeys. This is explained in the [blog post](https://ntag.fr/trainmap/).

Big thanks to the OpenStreetMap community for providing the data to make this possible.
